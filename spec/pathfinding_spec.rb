require_relative '../lib/chingu_pathfinding.rb'

class Dummy < Pathfinding
  MAP = [
    #                          |25
    "..................................................", # 00
    "..................................................", # 01
    "..................................................", # 02
    ".....*************************....................", # 03
    ".....*************************....................", # 04
    ".....*****............********....................", # 05
    ".....*****............********....................", # 06
    ".....*****............********....................", # 07
    "......................********************........", # 08
    "......................********************........", # 09
    "......................********************........", # 10
    "......................********************........", # 11
    "......................********....................", # 12
    "......................********....................", # 13
    "......................********...................."] # 15
      .map {|l| l.split('').map{|e| e != '.'} }
  def blocked?(x, y)
    MAP[y][x]
  end
end

describe Pathfinding do
  subject { Dummy.new(Dummy::MAP.first.length, Dummy::MAP.length, 5) }

  it "should find a straight line" do
    expect(subject.find_path(2,2,12,2)).to eq([[2, 2], [7, 2], [12, 2]])
  end

  it "should find a straight line with prefix" do
    expect(subject.find_path(0,0,12,2)).to eq([[0,0], [2, 2], [7, 2], [12, 2]])
  end

  it "should find a complex path" do
    expect(subject.find_path(2,12, 37, 12)).to eq([
      [2, 12], [2, 7], [2, 2], [7, 2], [12, 2],
      [17, 2], [22, 2], [27, 2], [32, 2], [37, 2],
      [42, 2], [42, 7], [42, 12], [37, 12]])
  end

  it "should display itself" do
    expect(subject.to_s).to eq(['map:',
       '                                                  ',
       '                                                  ',
       '  o.  .o.  .o.  .o.  .o.  .o.  .o.  .o.  .o.  .o  ',
       '  .                             ..  ...  ...  ..  ',
       '                                                  ',
       '                                                  ',
       '  .                             ..  ...  ...  ..  ',
       '  o    ~    o.  .o    ~    ~    o.  .o.  .o.  .o  ',
       '  ..       ...  ..                        ..  ..  ',
       '                                                  ',
       '                                                  ',
       '  .   . .   ..  ..                        ..  ..  ',
       '  o.  .o.  .o.  .o    ~    ~    o.  .o.  .o.  .o  ',
       '                                                  ',
       '                                                  ',
       ''].join("\n"))
  end
end
